---
title: '搜索书签前台'
date: 2022-7-8 07:15:24
cover: false
---

# 业务状态机模型

# `vue2`代码优化

略，直接整vue3

# `vue3`重构

## 初始化

- 安装`axios`，并按照接口文档配置

  提取后台接口地址为单独文件，`public`目录下新建`serverConfig.json`

  ```json
  {
    "baseURL": "http://127.0.0.1:7419"
  }
  ```

  新建`src/init.js`，初始化获取`ip`

  ```js
  import axios from "axios";
  import Vue from "vue";
  
  export async function getServerConfig() {
    return await new Promise((resolve, reject) => {
      axios
        .get("./serverConfig.json")
        .then((res) => {
          // console.log("读取外部化配置文件>>>>>>>>");
          // console.log(res.data); // 是否成功读取需要的配置项
          for (let key in res.data) {
          //   console.log(key);
            Vue.prototype["$" + key] = res.data[key];
          }
          // console.log(Vue.prototype.$baseURL); // 验证是否已经把属性挂载在了Vue的原型上
          resolve();
        })
        .catch((error) => {
          console.log(error);
          reject();
        });
    });
  }
  
  ```

  入口文件`main.js`中调用`init.js`

  ```js
  import {getServerConfig} from "@/utils/init.js";
  Vue.config.productionTip = false;
  
  new Vue({
    router,
    store,
    render: (h) => h(App),
    created() {
      getServerConfig() // 调用
    }
  }).$mount("#app");
  
  ```

  

  新建`src/utils/request.js`，基于函数封装`axios`

  ```js
  ```

  新建`src/api/home.js`

  ```js
  
  import {request} from "@/utils/request"
  
  export function getBackgroundData() {
    return request({url: '/img'})
  }
  
  export function getSearchIconData() {
      return request({url: '/search/engine'})
  }
  
  export function getSearchData(params) {
      return request({
          url: '/search/keyword',
          params: {
              query: params
          }
      })
  }
  
  export function getMotoData() {
      return request({
          url: '/search/hitokoto'
      })
  }
  // 添加搜索引擎
  export function addEngineUrl(data) {
      return request({
          method: 'post',
          url: '/search/engine/add',
          data
      })
  }
  
  // 添加搜索引擎
  export function modifyEngineUrl(data) {
      return request({
          method: 'post',
          url: '/search/engine/modify',
          data
      })
  }
  
  // 删除搜索引擎
  export function deleteEngineUrl(data) {
      return request({
          method: 'post',
          url: '/search/engine/delete',
          data
      })
  }
  
  // 默认搜索引擎
  export function defalutEngine() {
      return request({
          url: '/search/default-engine'
      })
  }
  
  ```

  

  

- 如果要关闭`eslint`

  `vue.config.js`

  ```js
  const { defineConfig } = require('@vue/cli-service')
  module.exports = defineConfig({
    transpileDependencies: true,
    lintOnSave: false
  })
  
  ```





# 交互优化

- 添加导航支持快捷键
- 新添加导航清除上次输入记录
- 插件默认加载页支持自定义（导航页或书签页）

刘春
