---
title: '状态机'
date: 2022-11-30 09:03:02
cover: false
tags:
- 认知
categories:: 认知
typora-root-url: 状态机
---

# 什么是状态机

[能不能通俗的讲解下什么是状态机？ - 知乎 (zhihu.com)](https://www.zhihu.com/question/375631543/answer/2485598947)

![image-20221130100855202](image-20221130100855202.png)

状态机是一种编程思路。一种对对自然界某种事物(或数据)**状态变化的抽象**。

让你的程序开发维护，思路更加清晰方便。

- 它规定了一个实例(某种抽象)，某一时刻只能有一种状态(属性)。一般用字符串表示。

- 规定了只能通过实例的方法，即执行某个动作(函数)，之后才可以改变状态(属性)。

就这两个规定。



再说有限状态机。和状态变更回调。

- 有限状态机，指上诉的状态机，总状态数种类是有限个。

  且规定变化到某种状态，需要验证当前状态是都合理。实现的话，实例化时候需要接收允许从某状态，变化到哪些状态。然后写一个验证，里面就一行 if 判断是否允许。(例如订单，代码层面，不允许从已付款变成未付款，允许从未付款变成已付款，直接改数据库的不算)

- 状态变更回调，指状态变更动作之前和之后执行的函数。

  状态变更动作可能是异步完成，有时候需要知道开始和结束。例如调试时候。



http 请求就是一个典型的有限状态机。状态有 open pending ending error等 ，stateChange ，success 等就是它的状态变更回调。且如果当前是 error ，不能从 error 变成 pending 了。



只要你满足了这些特征。就是状态机。

怎么实现是写法上不同，甚至实例化也不需要只用 new 。如果是自己实现，不用刻意照搬他人代码。

不过，几乎所有语言，都有别人写好的有限状态机的实现库，因为本身也没用多少难度，只要知道语法基础，就能写出来。希望能帮到你。





✔ 状态: 特定时间点的某个对象信息

✔ 转换: 状态之间的转换过程

✔状态机: 多个状态和状态之间的转换组成状态机

✔通常用来描述对象与时间的关系。



▲什么是状态机

状态机是有限状态自动机的简称。有限状态机（英语：finite-state machine，缩写：FSM）又称有限状态自动机（英语：finite-state automaton，缩写：FSA），简称状态机，是表示有限个状态以及在这些状态之间的转移和动作等行为的数学计算模型。

> 关于有限的解释：也就是被描述的事物的状态的数量是有限的，例如开关的状态只有“开”和“关”两个;灯的状态只有“亮”和“灭”等等。

▲特点

一个状态机可以具有有限个特定的状态，它通常根据输入，从一个状态转移到另一个状态，不过也可能存在瞬时状态，而一旦任务完成，状态机就会立刻离开瞬时状态。每个状态根据不同的前置条件，会从当前状态流转至下一个状态。

▲作用

使用状态机来表达状态的流转，会使语义会更加清晰，会增强代码的可读性和可维护性。

▲适用场景

面对复杂的状态流转(一般是超过三个及以上的状态流转)，那么还是比较建议用状态机来实现的。

![image-20221130101111166](image-20221130101111166.png)



# 关于状态机的技术选型

[关于状态机的技术选型，最后一个真心好！ - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/583410988)

今天跟大家分享一个关于“状态机”的话题。状态属性在我们的现实生活中无处不在。

比如电商场景会有一系列的订单状态(待支付、待发货、已发货、超时、关闭）；员工提交请假申请会有申请状态（已申请、审核中、审核成功、审核拒绝、结束）；差旅报销单会有单据审核状态（已提交、审核中、审核成功、退回、打款中、打款成功、打款失败、结束）等等。

上述场景有一个共同问题：根据不同触发条件执行不同处理动作最后落地不同的状态。示例代码如下:

```
Integer status=0;
    if(condition1){
        status=1;
    }else if(condition2){
        status=2;
    }else if(condition3){
        status=3;
    }else if(condition4){
        status=4;
    }
```

那我们最容易能想到的自然是if-else方案。那if-else方案会有什么问题呢？

主要有以下几点：

- 复杂的业务流程，if.else代码几乎无法维护
- 随着业务的发展，业务过程也需要变更及扩展，但if.else代码段已经无法支持
- 没有可读性，变更风险特别大，可能会牵一发而动全身，线上事故层出不穷
- 其他业务逻辑可能也会跟if-else代码块耦合在一起，带来更多的问题

![image-20221130100827168](image-20221130100827168.png)

状态机的出现就是用来解决上述问题的。在复杂多状态流转情况下，通过状态机的引入，我们希望相关代码可读性、扩展性能比if-else方案更好！



## 各个状态机方案

▲枚举状态机

Java中的枚举是一个定义了一系列常量的特殊类(**隐式继承自class java.lang.Enum**)。枚举类型因为自身的线程安全性保障和高可读性特性，是**简单状态机**的首选。





▲状态模式实现的状态机

是什么

状态模式是编程领域特有的名词，是 23 种设计模式之一，属于行为模式的一种。

它允许一个对象在其内部状态改变时改变它的行为。对象看起来似乎修改了它的类。

作用状态模式的设计意图主要是为了解决两个主要问题：

1. 当一个对象的内部状态改变时，它应该改变它的行为。
2. 应独立定义特定于状态的行为。也就是说，添加新状态不应影响现有状态的行为



▲开源实现

# 前端状态机

[关于 (zhangfisher.github.io)](https://zhangfisher.github.io/flexstate/#/readme)

[前端状态机：XState 首个中文文档上线了_王乐平的博客-CSDN博客_前端状态机](https://blog.csdn.net/lecepin/article/details/121901602)

**目前开源的有限状态机实现中比较知名的有：**

- `xstate`：堪称状态机航空母舰,功能太强大了，也太复杂了，学习成本非常高。
- `Javascript State Machine`：功能较弱，在实际试用过程中发现在进行异步切换时存在问题。
- `jssm`：特点是引入自己的DSL语法来描述状态机，使用起来比较别扭。





































